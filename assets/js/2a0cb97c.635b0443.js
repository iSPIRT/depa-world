"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[1180],{2332:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return c},toc:function(){return d},default:function(){return h}});var n=a(7462),i=a(3366),r=(a(7294),a(3905)),o=["components"],s={id:"confidential_clean_room_specifications",title:"Confidential Clean Rooms Specifications",description:"Confidential Clean Rooms Specifications"},l="Confidential Clean Rooms",c={unversionedId:"confidential_clean_room_specifications",id:"confidential_clean_room_specifications",title:"Confidential Clean Rooms Specifications",description:"Confidential Clean Rooms Specifications",source:"@site/internal/training/confidential_clean_room_specifications.md",sourceDirName:".",slug:"/confidential_clean_room_specifications",permalink:"/training/confidential_clean_room_specifications",editUrl:"https://github.com/iSPIRT/depa/edit/main/internal/training/confidential_clean_room_specifications.md",tags:[],version:"current",lastUpdatedAt:1692045823,formattedLastUpdatedAt:"8/15/2023",frontMatter:{id:"confidential_clean_room_specifications",title:"Confidential Clean Rooms Specifications",description:"Confidential Clean Rooms Specifications"},sidebar:"training",previous:{title:"Confidential Clean Room High Level Design",permalink:"/training/confidential_clean_room_design"},next:{title:"Differential Privacy",permalink:"/training/differential_privacy"}},d=[{value:"Dataset Format",id:"dataset-format",children:[],level:2},{value:"CCR Creation",id:"ccr-creation",children:[],level:2},{value:"Attestation",id:"attestation",children:[],level:2},{value:"Key Release Policies",id:"key-release-policies",children:[],level:2},{value:"Contract Validation",id:"contract-validation",children:[],level:2},{value:"Secure Key Release",id:"secure-key-release",children:[],level:2},{value:"Data and Model Loading",id:"data-and-model-loading",children:[],level:2},{value:"Data aggregation and pre-processing",id:"data-aggregation-and-pre-processing",children:[],level:2},{value:"Model Training",id:"model-training",children:[{value:"Model Architecture and Hyper-parameters",id:"model-architecture-and-hyper-parameters",children:[],level:3},{value:"Model format",id:"model-format",children:[],level:3},{value:"ML Frameworks",id:"ml-frameworks",children:[],level:3},{value:"Differentially Private Training",id:"differentially-private-training",children:[],level:3},{value:"Model release",id:"model-release",children:[],level:3},{value:"Notifications",id:"notifications",children:[],level:3}],level:2}],p={toc:d};function h(e){var t=e.components,s=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,n.Z)({},p,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"confidential-clean-rooms"},"Confidential Clean Rooms"),(0,r.kt)("p",null,"A confidential clean room (CCR) is a secure environment in which training datasets from one or more TDPs can be processed to train models while preserving privacy of data principals. CCRs support typical stages of an ML workflow, including data ingestion, aggregation, pre-processing and training within the constraints specified in contracts. This document describes functional and security requirements for confidential clean rooms. "),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"CCR data pipeline",src:a(9078).Z,width:"496",height:"256"})),(0,r.kt)("h2",{id:"dataset-format"},"Dataset Format"),(0,r.kt)("p",null,"TDPs shall publish datasets in schemas defined by the SRO. Dataset references registered with the contract service MUST contain a reference to an SRO specified schema. Contract services may check dataset references for well-formedness at registration. "),(0,r.kt)("p",null,"The SRO shall also define common formats for encrypted datasets. For example, datasets may be shared as binary files with AES-GCM encryption, or encrypted disk images protected using dm-crypt and dm-verity or dm-integrity/dm-verity. "),(0,r.kt)("h2",{id:"ccr-creation"},"CCR Creation"),(0,r.kt)("p",null,"When the TDC wishes to train or fine-tune a model, the CCR provider shall create a new CCR. A CCR may consist of one or more hardware isolated VMs with attached devices such as confidential ML accelerators and network cards. Each CCR is configured with "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"public identity of the contract service"),(0,r.kt)("li",{parentName:"ul"},"URL of the contract service(s) which issued the contracts"),(0,r.kt)("li",{parentName:"ul"},"set of contracts that will be used as a basis for training (specified as contract numbers, identifiers, or COSE signed objects)"),(0,r.kt)("li",{parentName:"ul"},"storage locations of training datasets"),(0,r.kt)("li",{parentName:"ul"},"storage location of the model to be trained"),(0,r.kt)("li",{parentName:"ul"},"model configuration, which may include hyper-parameters "),(0,r.kt)("li",{parentName:"ul"},"any additional configuration required by the CCR to access datasets e.g., access tokens. ")),(0,r.kt)("p",null,"CCRs are ephemeral compute resources created for each training task. In other words, CCRs SHALL not reused across multiple training tasks. "),(0,r.kt)("h2",{id:"attestation"},"Attestation"),(0,r.kt)("p",null,"The hardware supporting CCRs MUST generate attestation reports that capture the full trusted computing base (TCB) of the CCR. This includes (but not limited to) code and configuration of contract validation, secure key release, data and model loading, encryption and decryption, pre-processing, and training."),(0,r.kt)("p",null,"To protect the TDC's IP, attestation reports will not capture TDC secrets such as the model architecture, weights, and non-privacy related hyper-parameters. "),(0,r.kt)("p",null,"To ensure stable key release policies, attestation report SHALL not be contract-specific. However, attestation reports MUST capture the identity of the contract service."),(0,r.kt)("h2",{id:"key-release-policies"},"Key Release Policies"),(0,r.kt)("p",null,"In the DEPA training framework, TDPs retain full control over their datasets, even when they are shared with TDCs for training. In particular, TDPs can enforce that their datasets are only released to CCRs which"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Meet security requirements specified by the SRO"),(0,r.kt)("li",{parentName:"ul"},"Run code authorized by the SRO"),(0,r.kt)("li",{parentName:"ul"},"Use their datasets as per signed contracts")),(0,r.kt)("h2",{id:"contract-validation"},"Contract Validation"),(0,r.kt)("p",null,"Before loading any datasets or models, the CCR MUST validate the contracts. Contract validation includes the following checks. "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Participant identifies e.g., certificates are still valid"),(0,r.kt)("li",{parentName:"ul"},"Contracts are correctly signed by all the participants"),(0,r.kt)("li",{parentName:"ul"},"Contracts have not expired or been revoked. This check may require contacting the contract service to obtain receipts. ")),(0,r.kt)("p",null,"The CCR shall terminate if these conditions are not met. "),(0,r.kt)("h2",{id:"secure-key-release"},"Secure Key Release"),(0,r.kt)("p",null,"After validating contracts, the CCR shall identity  encryption key metadata (e.g., encryption key resource name and URL of the KMS) from the contracts for all datasets and the initial model. "),(0,r.kt)("p",null,"CCRs SHOULD use approved protocols (such as the Key Broker Attestation protocol) to retrieve encryption keys from the TDPs KMS. The specific protocol may vary based on the cloud platform and key management services. However, a typical protocol is expected to follow the typical ",(0,r.kt)("em",{parentName:"p"},"Request-Challenge-Attestation-Response")," method. "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Request"),": The CCR sends the initial Request payload to the TDP's KMS."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Challenge"),": After receiving the initial Request payload, the TDP's KMS responds with the Challenge payload. This is how the KMS sends the attestation challenge to the CCR. "),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Attestation"),": The CCR replies to the attestation challenge from step 2 with an attestation evidence, in order to prove that its environment (HW-TEE) is safe and reliable. The CCR sends an Attestation payload to the KMS, that contains the attestation evidence and the HW-TEE generated, ephemeral public key."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Response"),": The KMS returns a Response payload to a CCR requesting a resource if and only if the Attestation payload was successfully validated. The CCR requests resources by sending HTTP GET requests to resource specific endpoints.")),(0,r.kt)("h2",{id:"data-and-model-loading"},"Data and Model Loading"),(0,r.kt)("p",null,"After obtaining encryption keys, the CCR shall load  encrypted datasets and model from storage locations specified in the CCR configuration. Storage locations may be different from the ones specified in the contract since the the CCR provider may cache the datasets in a different storage location e.g., closer to the location where the CCR compute is provisioned. "),(0,r.kt)("h2",{id:"data-aggregation-and-pre-processing"},"Data aggregation and pre-processing"),(0,r.kt)("p",null,"Preparing data for training often involves multiple steps e.g., joining datasets, sanitizing the data, pre-processing etc. Conventionally, data scientists have access to training datasets, and can manually inspect and transform datasets (e.g., in a Python workbook). However, CCR is an ",(0,r.kt)("strong",{parentName:"p"},"eyes-off")," environment where direct access to the datasets is not available. Instead, TDCs specify ",(0,r.kt)("em",{parentName:"p"},"pipelines")," that execute within the CCR. Pipelines may be specified in DSLs such as Kubeflow. The CCR executes pipelines subject to the following constraints "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Pipelines must comply with data usage policy associated in each dataset. "),(0,r.kt)("li",{parentName:"ul"},"Operations may be restricted to enforce privacy constraints. For example, join operations may be constrained to produce datasets with one row per data principal to simplify ",(0,r.kt)("a",{parentName:"li",href:"/training/differential_privacy"},"privacy accounting"),". ")),(0,r.kt)("p",null,"All intermediate datasets created during the execution of a pipeline SHALL remain protected within the CCR e.g., stored on an encrypted and integrity protected disk. Aggregate results from the pipeline e.g., cardinality of an intermediate dataset MAY be shared with the TDC as long as they are computed using a differentially private mechanism within the privacy budget specified in the contract. "),(0,r.kt)("h2",{id:"model-training"},"Model Training"),(0,r.kt)("p",null,"The CCR enables TDCs to train or fine-tune a broad class of AI models on pre-processed and aggregated datasets while protecting both the model and the datasets from all participants. "),(0,r.kt)("h3",{id:"model-architecture-and-hyper-parameters"},"Model Architecture and Hyper-parameters"),(0,r.kt)("p",null,"Training models is usually an iterative and exploratory process to find a model architecture and hyper-parameters (such as batch size and learning rate) that minimizes loss and achieves fast convergence. However, given the sensitivity of the datasets and constraints imposed by the CCR environment, TDCs will be expected to use a slightly different process of training models in the CCR. In particular, the TDCs are expected to perform most of the exploration and tuning outside the CCR environment using public data and/or sample data provided by the TDPs. Once the TDC has identified the optimum model architecture and hyper-parameters, the model can be trained and/or fine-tuning on private data within the CCR. "),(0,r.kt)("h3",{id:"model-format"},"Model format"),(0,r.kt)("p",null,"CCRs SHALL support loading models in safe interchange formats defined by the SRO. Models that require custom code (e.g., custom layers or custom CUDA kernels) shall not be supported in the CCR."),(0,r.kt)("p",null,"In order to protect the models from the CCR provider, CCR SHALL support loading of encrypted models with keys hosted in key management services hosted by the TDCs. This process is akin to support for encrypted datasets. "),(0,r.kt)("h3",{id:"ml-frameworks"},"ML Frameworks"),(0,r.kt)("p",null,"CCRs MAY provide TDCs with a choice of the ML framework to use for training. "),(0,r.kt)("h3",{id:"differentially-private-training"},"Differentially Private Training"),(0,r.kt)("p",null,"For sensitive datasets containing personally identifiable information, CCRs MUST support training algorithms that guarantee differential privacy. Additional constraints may apply in such scenarios; see ",(0,r.kt)("a",{parentName:"p",href:"/training/differential_privacy"},"Differentially Private Training")," for detailed specifications. "),(0,r.kt)("h3",{id:"model-release"},"Model release"),(0,r.kt)("p",null,"The CCR MUST use a secure protocol to save and encrypt the trained model and ensure that the model is released only to the TDC. For example, the CCR can generate a fresh model encryption key, encrypt the model using this key, and wrap the key with the TDC's public key. "),(0,r.kt)("h3",{id:"notifications"},"Notifications"),(0,r.kt)("p",null,"During training, CCRs SHALL generate various events and notifications. This includes "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Notifications to the contract service before obtaining encryption keys, and before releasing the model to the TDC. These notifications allow the contract service to discharge obligations in the contract e.g., blocking and making payments. "),(0,r.kt)("li",{parentName:"ul"},"Notifications to the TDP before releasing the model to the TDC. These notifications allow the TDP to perform book-keeping activities such as manage privacy budgets.")))}h.isMDXComponent=!0},9078:function(e,t,a){t.Z=a.p+"assets/images/pipeline.drawio-9c05ef9451554d0e55ea19886e3ecb55.png"},3905:function(e,t,a){a.d(t,{Zo:function(){return d},kt:function(){return u}});var n=a(7294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var l=n.createContext({}),c=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},d=function(e){var t=c(e.components);return n.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},h=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),h=c(a),u=i,f=h["".concat(l,".").concat(u)]||h[u]||p[u]||r;return a?n.createElement(f,o(o({ref:t},d),{},{components:a})):n.createElement(f,o({ref:t},d))}));function u(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,o=new Array(r);o[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var c=2;c<r;c++)o[c]=a[c];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}h.displayName="MDXCreateElement"}}]);